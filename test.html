<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="/lib/phaser.js"></script>
</head>
<body>
<canvas width="800" height="650" id="game"></canvas>
</body>
<script src="shared/SpaceMap.js" type="text/javascript"></script>
<script src="shared/Pathfinder.js" type="text/javascript"></script>
<script src="shared/Utils.js" type="text/javascript"></script>
<script type="text/javascript">

    var c_canvas = document.getElementById("game");
    var context = c_canvas.getContext("2d");

    var ts = 32;
    var height = 640;
    var width = 640;

    for (var x = 0.5; x < width+1; x += ts) {
        context.moveTo(x, 0);
        context.lineTo(x, width);
    }

    for (var y = 0.5; y < height+1; y += ts) {
        context.moveTo(0, y);
        context.lineTo(height, y);
    }

    for(var x = 0; x < width/ts; x++){
        for(var y = 0; y < height/ts; y++){
            context.fillText(x+","+y,(x*ts),(y*ts)+10);
        }
    }

    context.strokeStyle = "#ddd";
    context.stroke();

    var grid = new SpaceMap();
    var exclGrid = new SpaceMap();
    exclGrid.add(4,2);
    exclGrid.add(5,2);

    function blacken(tx,ty){
        context.fillStyle = "#000000";
        context.fillRect(tx*ts,ty*ts,ts,ts);
        grid.add(tx,ty);
    }

    blacken(5,6);
    blacken(6,1);
    blacken(6,2);
    blacken(6,3);
    blacken(6,4);
    blacken(6,5);
    blacken(6,6);
    blacken(1,6);
    blacken(2,6);
    blacken(3,6);
    blacken(4,6);


    /*for(var i = 0; i < 10; i++){
        var tx = Utils.randomInt(0,19);
        var ty = Utils.randomInt(0,19);
        blacken(tx,ty);
    }*/

    c_canvas.onclick = function(e){
        var tx = Math.floor(e.layerX/ts);
        var ty = Math.floor(e.layerY/ts);
        console.log(tx+','+ty);
        blacken(tx,ty);
    };

    function onOpen(tx,ty){
        //console.log('adding ',tx,ty,'to open set');
        context.fillStyle = "#00aaff";
        context.fillRect(tx*ts+1,ty*ts+1,ts-2,ts-2);
    }

    function onClose(tx,ty){
        //console.log('adding ',tx,ty,'to closed set');
        context.fillStyle = "#00cc00";
        context.fillRect(tx*ts+1,ty*ts+1,ts-2,ts-2);
    }

    function onBacktrack(tx,ty){
        //console.log('Backtracking to',tx,ty);
        context.fillStyle = "#ffcc00";
        context.fillRect(tx*ts+1,ty*ts+1,ts-2,ts-2);
    }

    World = {
        worldWidth: 20,
        worldHeight: 20
    };

    function pf(sx,sy,ex,ey){
        var finder = new Pathfinder(grid,50,false);
        finder.setCallbacks(onOpen,onClose,onBacktrack);
        finder.findPath({x:sx,y:sy},{x:ex,y:ey});
        console.log(finder.heuristic(
            {x:7,
            y:3},
            {x:17,
            y:5}
        ));
        console.log(finder.heuristic(
            {x:8,
                y:2},
            {x:17,
                y:5}
        ))
    }
</script>
</html>